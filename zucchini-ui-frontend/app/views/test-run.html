<div>

  <ol class="breadcrumb">
    <li>Type {{ ctrl.testRun.type }}</li>
    <li class="active">Tir du {{ ctrl.testRun.date | niceDate }}</li>
  </ol>

  <h1>Tir du {{ ctrl.testRun.date | niceDate }}</h1>

  <p>
    <b>Identifiant du tir :</b>
    <code>{{ ctrl.testRun.id }}</code>
  </p>

  <p ng-repeat="label in ctrl.testRun.labels">
    <b>{{ label.name }} :</b>
    <a ng-if="label.url" ng-href="{{ label.url }}">{{ label.value }}</a>
    <span ng-if="!label.url">{{ label.value }}</span>
  </p>

  <hr>

  <div class="btn-toolbar" role="toolbar">
    <div class="btn-group" role="group">

      <button ng-click="ctrl.openImportForm()" class="btn btn-default" ng-disabled="ctrl.testRun.locked">
        <tc-glyphicon name="upload"></tc-glyphicon>
        Importer un résultat de tests Cucumber
      </button>

    </div>
    <div class="btn-group" role="group">

      <button ng-click="ctrl.openUpdateTestRunForm()" class="btn btn-default" ng-disabled="ctrl.testRun.locked">
        <tc-glyphicon name="pencil"></tc-glyphicon>
        Modifier
      </button>

    </div>
    <div class="btn-group" role="group">

      <a ng-href="#/test-runs/{{ ctrl.testRun.id }}/tags" class="btn btn-default">
        <tc-glyphicon name="tags"></tc-glyphicon>
        Tags
      </a>

    </div>
    <div class="btn-group" role="group">

      <a ng-href="#/test-runs/{{ ctrl.testRun.id }}/diff" class="btn btn-default">
        <tc-glyphicon name="list-alt"></tc-glyphicon>
        Comparer avec un autre tir
      </a>

    </div>
    <div class="btn-group" role="group">

      <button ng-click="ctrl.lock()" class="btn btn-default" ng-if="!ctrl.testRun.locked">
        <tc-glyphicon name="pause"></tc-glyphicon>
        Verrouiller
      </button>

      <button ng-click="ctrl.unlock()" class="btn btn-default" ng-if="ctrl.testRun.locked">
        <tc-glyphicon name="play"></tc-glyphicon>
        Déverrouiller
      </button>

    </div>
    <div class="btn-group" role="group">

      <button ng-click="ctrl.delete()" class="btn btn-danger" ng-disabled="ctrl.testRun.locked">
        <tc-glyphicon name="remove"></tc-glyphicon>
        Supprimer
      </button>

    </div>
  </div>

  <!-- Stats -->

  <hr>

  <h2>Avancement par scénario</h2>

  <tc-stats-dashboard stats="ctrl.testRun.stats"></tc-stats-dashboard>


  <!-- Features -->

  <hr>

  <h2>Fonctionnalités</h2>

  <tc-feature-list features="ctrl.testRun.features">
  </tc-feature-list>


  <!-- History -->

  <hr>

  <h2>Historique</h2>

  <table class="table table-bordered">
    <thead>
    <tr>
      <th class="col-md-6">Tir</th>
      <th class="col-md-1">Total</th>
      <th class="col-md-1">Succès</th>
      <th class="col-md-1">Échecs</th>
      <th class="col-md-1">En attente</th>
      <th class="col-md-1">Non joués</th>
      <th class="col-md-1">Analysés</th>
    </tr>
    </thead>
    <tbody>
    <tr ng-repeat="testRun in ctrl.history track by testRun.id"
        ng-class="ctrl.testRun.id == testRun.id && 'active'">
      <td>
        <a ng-href="#/test-runs/{{ testRun.id }}">
          {{ testRun.date | niceDate }}
        </a>
      </td>
      <td><span class="badge">{{ testRun.stats.all.count }}</span></td>
      <td><span class="badge">{{ testRun.stats.all.passed }}</span></td>
      <td><span class="badge">{{ testRun.stats.all.failed }}</span></td>
      <td><span class="badge">{{ testRun.stats.all.pending }}</span></td>
      <td><span class="badge">{{ testRun.stats.all.notRun }}</span></td>
      <td><span class="badge">{{ testRun.stats.reviewed.count }}</span></td>
    </tr>
    </tbody>
  </table>

  <!-- Import cucumber results modal window -->

  <script type="text/ng-template" id="importCucumberResults.html">
    <form name="importForm" ng-submit="importForm.$valid && importCtrl.import()" novalidate>

      <div class="modal-header">
        <button type="button" class="close" ng-click="$dismiss()" aria-label="Fermer">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">Importer un résultat de tests Cucumber</h4>
      </div>

      <div class="modal-body">

        <div class="form-group">
          <label for="file">Fichier à importer</label>
          <input type="file" id="file" ng-model="importCtrl.file" ngf-select ngf-pattern="'.json'" autofocus required>
          <p class="help-block">Le fichier à importer est un résultat d'exécution Cucumber, au format JSON.</p>
        </div>

        <div class="form-group">
          <label for="group">Groupe</label>
          <input type="text" id="group" ng-model="importCtrl.importOptions.group" class="form-control"
                 placeholder="Nom d'un groupe pour les fonctionnalités importées">
        </div>

        <div class="checkbox">
          <label>
            <input type="checkbox" ng-model="importCtrl.importOptions.onlyNewScenarii">
            Limiter l'import aux nouveaux scénarii
          </label>
        </div>

        <div class="checkbox">
          <label>
            <input type="checkbox" ng-model="importCtrl.importOptions.dryRun">
            Tir à blanc
          </label>
        </div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="$dismiss()">Annuler</button>
        <button type="submit" class="btn btn-primary" ng-disabled="importForm.$invalid">Importer</button>
      </div>

    </form>
  </script>

  <!-- Edit test run modal window -->
  <script type="text/ng-template" id="updateTestRunForm.html">
    <form name="editForm" ng-submit="editForm.$valid && updateCtrl.update()" novalidate>

      <div class="modal-header">
        <button type="button" class="close" ng-click="$dismiss()" aria-label="Fermer">
          <span aria-hidden="true">&times;</span>
        </button>
        <h4 class="modal-title">Modifier les informations du tir</h4>
      </div>

      <div class="modal-body">

        <div class="form-group" ng-class="editForm.type.$invalid && 'has-error'">
          <label for="type">Type</label>
          <input name="type" type="text" class="form-control" id="type" ng-model="updateCtrl.updateRequest.type"
                 required autofocus>
        </div>

        <div class="form-group">

          <label>Étiquettes</label>

          <table class="table">
            <thead>
            <tr>
              <th class="col-md-4">Nom</th>
              <th class="col-md-4">Valeur</th>
              <th class="col-md-4">URL</th>
              <th>&nbsp;</th>
            </tr>
            </thead>
            <tbody>

            <!-- Labels -->
            <tr ng-repeat="label in updateCtrl.updateRequest.labels" ng-form="labelForm">

              <td ng-class="labelForm.name.$invalid && 'has-error'">
                <input name="name" ng-model="label.name" class="form-control input-sm" required placeholder="Nom">
              </td>
              <td ng-class="labelForm.value.$invalid && 'has-error'">
                <input name="value" ng-model="label.value" class="form-control input-sm" required placeholder="Valeur">
              </td>
              <td ng-class="labelForm.url.$invalid && 'has-error'">
                <input name="url" type="url" ng-model="label.url" class="form-control input-sm" placeholder="URL">
              </td>
              <td>
                <button type="button" class="btn btn-sm btn-danger"
                        uib-tooltip="Supprimer" tooltip-placement="right"
                        ng-click="updateCtrl.deleteLabel($index)">
                  <tc-glyphicon name="remove"></tc-glyphicon>
                </button>
              </td>

            </tr>

            <tr>
              <td colspan="4">
                <button type="button" class="btn btn-sm btn-default"
                        uib-tooltip="Ajouter" tooltip-placement="right"
                        ng-disabled="newLabelForm.url.$invalid"
                        ng-click="updateCtrl.addNewLabel()">
                  <tc-glyphicon name="plus-sign"></tc-glyphicon>
                  Ajouter une étiquette
                </button>
              </td>
            </tr>

            </tbody>
          </table>

        </div>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-default" ng-click="$dismiss()">Annuler</button>
        <button type="submit" class="btn btn-primary" ng-disabled="editForm.$invalid">Modifier</button>
      </div>

    </form>
  </script>

</div>
